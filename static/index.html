<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>School Chat - Connect & Learn Together</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="/static/css/style.css" rel="stylesheet">
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="container">
      <div class="flex items-center justify-between" style="height: 64px;">
        <div class="flex items-center gap-4">
          <a href="/" class="navbar-brand">
            <i class="fas fa-graduation-cap mr-2"></i>
            School Chat
          </a>
          <div id="connection-status" class="status-indicator status-offline">
            <i class="fas fa-circle mr-1"></i>
            Connecting...
          </div>
        </div>
        <div class="flex items-center gap-4">
          <span id="user-display" class="text-sm text-gray-600">Welcome, Student</span>
          <a href="/static/rooms.html" class="btn btn-secondary btn-sm">
            <i class="fas fa-cog mr-1"></i>
            Manage Rooms
          </a>
          <button id="logout-btn" class="btn btn-error btn-sm">
            <i class="fas fa-sign-out-alt mr-1"></i>
            Logout
          </button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Chat Container -->
  <div class="container" style="padding-top: 2rem; padding-bottom: 2rem;">
    <div class="chat-container">
      <!-- Rooms Sidebar -->
      <div class="rooms-sidebar">
        <div class="rooms-header">
          <h3 class="text-lg font-semibold text-gray-900 mb-2">Chat Rooms</h3>
          <div class="flex gap-2">
            <input 
              type="text" 
              id="new-room-name" 
              class="form-control" 
              placeholder="Create new room..."
              style="flex: 1;"
            >
            <button id="create-room-btn" class="btn btn-primary">
              <i class="fas fa-plus"></i>
            </button>
          </div>
        </div>
        
        <div class="rooms-list">
          <!-- Default Rooms -->
          <div class="room-item" data-room="General">
            <div class="flex items-center gap-3">
              <div class="w-3 h-3 rounded-full bg-green-500"></div>
              <div>
                <div class="room-name">General</div>
                <div class="room-meta">General discussion</div>
              </div>
            </div>
          </div>
          
          <div class="room-item" data-room="Math-101">
            <div class="flex items-center gap-3">
              <div class="w-3 h-3 rounded-full bg-blue-500"></div>
              <div>
                <div class="room-name">Math 101</div>
                <div class="room-meta">Calculus & Algebra</div>
              </div>
            </div>
          </div>
          
          <div class="room-item" data-room="Physics-Lab">
            <div class="flex items-center gap-3">
              <div class="w-3 h-3 rounded-full bg-purple-500"></div>
              <div>
                <div class="room-name">Physics Lab</div>
                <div class="room-meta">Lab discussions</div>
              </div>
            </div>
          </div>
          
          <div class="room-item" data-room="Chemistry">
            <div class="flex items-center gap-3">
              <div class="w-3 h-3 rounded-full bg-orange-500"></div>
              <div>
                <div class="room-name">Chemistry</div>
                <div class="room-meta">Organic & Inorganic</div>
              </div>
            </div>
          </div>
          
          <div class="room-item" data-room="Study-Group">
            <div class="flex items-center gap-3">
              <div class="w-3 h-3 rounded-full bg-pink-500"></div>
              <div>
                <div class="room-name">Study Group</div>
                <div class="room-meta">Group study sessions</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Chat Main Area -->
      <div class="chat-main">
        <!-- Chat Header -->
        <div class="chat-header">
          <div class="flex items-center justify-between">
            <div>
              <h2 id="current-room" class="text-xl font-semibold text-gray-900">Select a Room</h2>
              <p class="text-sm text-gray-500">Choose a room to start chatting</p>
            </div>
            <div class="flex items-center gap-2">
              <button id="room-info-btn" class="btn btn-secondary btn-sm" disabled>
                <i class="fas fa-info-circle mr-1"></i>
                Room Info
              </button>
              <button id="room-settings-btn" class="btn btn-secondary btn-sm" disabled>
                <i class="fas fa-cog mr-1"></i>
                Settings
              </button>
            </div>
          </div>
        </div>

        <!-- Messages Area -->
        <div class="chat-messages" id="messages">
          <div class="text-center text-gray-500 py-8">
            <i class="fas fa-comments text-4xl mb-4"></i>
            <h3 class="text-lg font-medium mb-2">Welcome to School Chat!</h3>
            <p>Select a room from the sidebar to start chatting with your classmates.</p>
          </div>
        </div>

        <!-- Typing Indicator -->
        <div id="typing-indicator" class="px-6 py-2 text-sm text-gray-500 italic" style="display: none;">
          <i class="fas fa-circle text-xs mr-1"></i>
          <span></span>
        </div>

        <!-- Chat Input -->
        <div class="chat-input">
          <form id="message-form" class="message-form">
            <textarea 
              id="message-input" 
              class="message-input" 
              placeholder="Type your message... (Shift+Enter for new line)"
              disabled
              rows="1"
            ></textarea>
            <button type="submit" id="send-btn" class="send-btn" disabled>
              <i class="fas fa-paper-plane"></i>
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Room Info Modal -->
  <div id="room-info-modal" class="hidden" style="position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;">
    <div class="card" style="max-width: 500px; width: 90%;">
      <div class="card-header">
        <h3 class="text-lg font-semibold">Room Information</h3>
      </div>
      <div class="card-body">
        <div class="space-y-4">
          <div>
            <label class="form-label">Room Name</label>
            <p id="modal-room-name" class="text-gray-900">-</p>
          </div>
          <div>
            <label class="form-label">Description</label>
            <p id="modal-room-description" class="text-gray-600">-</p>
          </div>
          <div>
            <label class="form-label">Members</label>
            <p id="modal-room-members" class="text-gray-600">-</p>
          </div>
          <div>
            <label class="form-label">Created</label>
            <p id="modal-room-created" class="text-gray-600">-</p>
          </div>
        </div>
      </div>
      <div class="card-footer">
        <button id="close-room-info" class="btn btn-secondary btn-full">Close</button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="/static/js/utils.js"></script>
  <script src="/static/js/mobile-nav.js"></script>
  <script src="/static/js/chat-app.js"></script>
  
  <script>
    // Additional initialization
    document.addEventListener('DOMContentLoaded', () => {
      // Logout functionality
      Utils.on('#logout-btn', 'click', () => {
        if (confirm('Are you sure you want to logout?')) {
          Utils.removeStorage('authToken');
          Utils.removeStorage('user');
          window.location.href = '/static/login.html';
        }
      });

      // Room info modal
      Utils.on('#room-info-btn', 'click', () => {
        Utils.showModal('#room-info-modal');
      });

      Utils.on('#close-room-info', 'click', () => {
        Utils.hideModal('#room-info-modal');
      });

      // Close modal on outside click
      Utils.on('#room-info-modal', 'click', (e) => {
        if (e.target.id === 'room-info-modal') {
          Utils.hideModal('#room-info-modal');
        }
      });

      // Keyboard shortcuts info
      Utils.on(document, 'keydown', (e) => {
        if (e.key === '?' && (e.ctrlKey || e.metaKey)) {
          e.preventDefault();
          Utils.showNotification('Keyboard Shortcuts: Ctrl+K (focus input), Escape (clear input)', 'info', 5000);
        }
      });
    });
  </script>
</body>
</html>